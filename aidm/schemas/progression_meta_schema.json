{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "progression_meta_schema.json",
  "title": "Progression Meta-Schema",
  "description": "Parameterized meta-schema for character progression systems. Defines how characters grow stronger over time.",
  "version": "1.0.0",
  "type": "object",
  "required": ["type"],
  "properties": {
    "type": {
      "type": "string",
      "description": "The progression system type",
      "enum": ["mastery_tiers", "class_based", "quirk_awakening", "milestone_based", "static_op"]
    }
  },
  "allOf": [
    {
      "if": {
        "properties": { "type": { "const": "mastery_tiers" } }
      },
      "then": {
        "properties": {
          "type": { "const": "mastery_tiers" },
          "parameters": {
            "type": "object",
            "required": ["system_name", "mastery_levels", "categories"],
            "properties": {
              "system_name": {
                "type": "string",
                "description": "Name of the power system (e.g., 'Nen', 'Chakra', 'Alchemy')"
              },
              "mastery_levels": {
                "type": "array",
                "description": "Tiers of mastery progression",
                "items": { "type": "string" },
                "minItems": 2
              },
              "categories": {
                "type": "array",
                "description": "Specialization paths (e.g., ['Enhancement', 'Transmutation'])",
                "items": { "type": "string" },
                "minItems": 1
              },
              "advancement_method": {
                "type": "string",
                "description": "How characters advance tiers",
                "enum": ["practice_hours", "breakthrough", "training_arc"],
                "default": "practice_hours"
              }
            }
          },
          "mechanics": {
            "type": "object",
            "properties": {
              "leveling": { "type": "string", "const": "tier_based_unlock" },
              "skills": { "type": "string", "const": "mastery_level_determines_access" },
              "power_curve": { "type": "string", "const": "exponential_with_conditions" }
            }
          }
        },
        "required": ["parameters", "mechanics"]
      }
    },
    {
      "if": {
        "properties": { "type": { "const": "class_based" } }
      },
      "then": {
        "properties": {
          "type": { "const": "class_based" },
          "parameters": {
            "type": "object",
            "required": ["available_classes"],
            "properties": {
              "available_classes": {
                "type": "array",
                "description": "Playable classes (e.g., ['Warrior', 'Mage', 'Rogue'])",
                "items": { "type": "string" },
                "minItems": 1
              },
              "multiclass_allowed": {
                "type": "boolean",
                "description": "Whether characters can have multiple classes",
                "default": false
              },
              "max_level": {
                "type": "integer",
                "description": "Maximum character level",
                "default": 20,
                "minimum": 1
              },
              "stat_growth": {
                "type": "string",
                "description": "How stats increase per level",
                "enum": ["fixed", "random", "choice"],
                "default": "fixed"
              }
            }
          },
          "mechanics": {
            "type": "object",
            "properties": {
              "leveling": { "type": "string", "const": "xp_threshold_system" },
              "skills": { "type": "string", "const": "class_skill_trees" },
              "power_curve": { "type": "string", "const": "linear_with_capstone_abilities" }
            }
          }
        },
        "required": ["parameters", "mechanics"]
      }
    },
    {
      "if": {
        "properties": { "type": { "const": "quirk_awakening" } }
      },
      "then": {
        "properties": {
          "type": { "const": "quirk_awakening" },
          "parameters": {
            "type": "object",
            "required": ["power_name", "awakening_stages", "evolution_triggers"],
            "properties": {
              "power_name": {
                "type": "string",
                "description": "Name of the power type (e.g., 'Quirk', 'Devil Fruit', 'Stand')"
              },
              "awakening_stages": {
                "type": "array",
                "description": "Stages of power evolution",
                "items": { "type": "string" },
                "minItems": 2
              },
              "evolution_triggers": {
                "type": "array",
                "description": "What causes evolution (e.g., ['emotional_breakthrough', 'near_death'])",
                "items": { "type": "string" },
                "minItems": 1
              }
            }
          },
          "mechanics": {
            "type": "object",
            "properties": {
              "leveling": { "type": "string", "const": "narrative_milestone_unlocks" },
              "skills": { "type": "string", "const": "power_evolution_tree" },
              "power_curve": { "type": "string", "const": "steep_at_awakening_moments" }
            }
          }
        },
        "required": ["parameters", "mechanics"]
      }
    },
    {
      "if": {
        "properties": { "type": { "const": "milestone_based" } }
      },
      "then": {
        "properties": {
          "type": { "const": "milestone_based" },
          "parameters": {
            "type": "object",
            "required": ["milestone_events", "power_grants"],
            "properties": {
              "milestone_events": {
                "type": "array",
                "description": "Story events that grant power",
                "items": { "type": "string" },
                "minItems": 1
              },
              "power_grants": {
                "type": "object",
                "description": "What each milestone unlocks",
                "additionalProperties": {
                  "type": "array",
                  "items": { "type": "string" }
                }
              }
            }
          },
          "mechanics": {
            "type": "object",
            "properties": {
              "leveling": { "type": "string", "const": "narrative_only" },
              "skills": { "type": "string", "const": "story_unlocked" },
              "power_curve": { "type": "string", "const": "dm_controlled" }
            }
          }
        },
        "required": ["parameters", "mechanics"]
      }
    },
    {
      "if": {
        "properties": { "type": { "const": "static_op" } }
      },
      "then": {
        "properties": {
          "type": { "const": "static_op" },
          "parameters": {
            "type": "object",
            "required": ["starting_power_tier"],
            "properties": {
              "starting_power_tier": {
                "type": "integer",
                "description": "Power tier at character creation (1-10 scale)",
                "minimum": 1,
                "maximum": 10
              },
              "growth_focus": {
                "type": "string",
                "description": "What character develops instead of raw power",
                "enum": ["none", "technique_variety", "control"],
                "default": "none"
              }
            }
          },
          "mechanics": {
            "type": "object",
            "properties": {
              "leveling": { "type": "string", "const": "disabled" },
              "skills": { "type": "string", "const": "all_unlocked_or_static" },
              "power_curve": { "type": "string", "const": "flat_maximum" }
            }
          }
        },
        "required": ["parameters", "mechanics"]
      }
    }
  ]
}
