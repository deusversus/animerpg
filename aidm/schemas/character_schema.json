{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "AIDM Character Schema",
  "description": "Complete player character data structure for AIDM v2 system",
  "type": "object",
  "required": [
    "schema_version",
    "character_id",
    "name",
    "created_at",
    "last_updated",
    "core_identity",
    "resources",
    "attributes",
    "skills",
    "progression",
    "inventory",
    "relationships",
    "quests",
    "world_context"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "description": "Schema version for migration compatibility tracking",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "default": "2.0.0"
    },
    "character_id": {
      "type": "string",
      "description": "Unique identifier for this character",
      "pattern": "^char_[a-zA-Z0-9]{16}$"
    },
    "name": {
      "type": "string",
      "description": "Character's full name",
      "minLength": 1,
      "maxLength": 100
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of character creation"
    },
    "last_updated": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of last state update"
    },
    
    "core_identity": {
      "type": "object",
      "description": "Immutable character identity and backstory",
      "required": ["origin", "personality", "goals", "appearance"],
      "properties": {
        "origin": {
          "type": "string",
          "description": "Character backstory and how they came to this world",
          "maxLength": 2000
        },
        "personality": {
          "type": "array",
          "description": "Core personality traits",
          "items": {
            "type": "string",
            "maxLength": 50
          },
          "minItems": 3,
          "maxItems": 8
        },
        "goals": {
          "type": "array",
          "description": "Long-term character motivations",
          "items": {
            "type": "string",
            "maxLength": 200
          },
          "minItems": 1,
          "maxItems": 5
        },
        "appearance": {
          "type": "string",
          "description": "Physical description",
          "maxLength": 1000
        },
        "unique_abilities": {
          "type": "array",
          "description": "Special powers or traits unique to this character",
          "items": {
            "type": "object",
            "required": ["name", "description"],
            "properties": {
              "name": {"type": "string", "maxLength": 100},
              "description": {"type": "string", "maxLength": 500},
              "source": {"type": "string", "description": "Anime/origin of this ability"},
              "limitations": {"type": "string", "maxLength": 300}
            }
          }
        }
      }
    },
    
    "resources": {
      "type": "object",
      "description": "Current resource pools (HP/MP/SP)",
      "required": ["hp", "mp", "sp"],
      "properties": {
        "hp": {
          "type": "object",
          "description": "Health Points",
          "required": ["current", "maximum"],
          "properties": {
            "current": {"type": "integer", "minimum": 0},
            "maximum": {"type": "integer", "minimum": 1},
            "temporary": {"type": "integer", "minimum": 0, "default": 0}
          }
        },
        "mp": {
          "type": "object",
          "description": "Mana/Magic Points",
          "required": ["current", "maximum"],
          "properties": {
            "current": {"type": "integer", "minimum": 0},
            "maximum": {"type": "integer", "minimum": 0},
            "temporary": {"type": "integer", "minimum": 0, "default": 0}
          }
        },
        "sp": {
          "type": "object",
          "description": "Stamina Points",
          "required": ["current", "maximum"],
          "properties": {
            "current": {"type": "integer", "minimum": 0},
            "maximum": {"type": "integer", "minimum": 1},
            "temporary": {"type": "integer", "minimum": 0, "default": 0}
          }
        },
        "conditions": {
          "type": "array",
          "description": "Active status effects (buffs/debuffs)",
          "items": {
            "type": "object",
            "required": ["name", "type", "duration"],
            "properties": {
              "name": {"type": "string"},
              "type": {"type": "string", "enum": ["buff", "debuff", "neutral"]},
              "description": {"type": "string"},
              "duration": {"type": "integer", "description": "Turns remaining, -1 for permanent"},
              "effects": {
                "type": "object",
                "description": "Mechanical effects",
                "properties": {
                  "hp_modifier": {"type": "integer"},
                  "mp_modifier": {"type": "integer"},
                  "sp_modifier": {"type": "integer"},
                  "stat_modifiers": {"type": "object"}
                }
              }
            }
          }
        }
      }
    },
    
    "attributes": {
      "type": "object",
      "description": "Core character attributes/stats",
      "properties": {
        "strength": {"type": "integer", "minimum": 1, "maximum": 999},
        "dexterity": {"type": "integer", "minimum": 1, "maximum": 999},
        "constitution": {"type": "integer", "minimum": 1, "maximum": 999},
        "intelligence": {"type": "integer", "minimum": 1, "maximum": 999},
        "wisdom": {"type": "integer", "minimum": 1, "maximum": 999},
        "charisma": {"type": "integer", "minimum": 1, "maximum": 999},
        "custom_stats": {
          "type": "object",
          "description": "Anime-specific attributes (chakra control, ki sensitivity, etc.)",
          "additionalProperties": {"type": "integer"}
        }
      }
    },
    
    "skills": {
      "type": "array",
      "description": "Learned skills and techniques",
      "items": {
        "type": "object",
        "required": ["skill_id", "name", "category", "level", "experience"],
        "properties": {
          "skill_id": {"type": "string"},
          "name": {"type": "string"},
          "category": {
            "type": "string",
            "enum": ["physical", "magical", "psionic", "hybrid", "unique"]
          },
          "level": {"type": "integer", "minimum": 1, "maximum": 100},
          "experience": {"type": "integer", "minimum": 0},
          "description": {"type": "string", "maxLength": 500},
          "cost": {
            "type": "object",
            "description": "Resource cost to use",
            "properties": {
              "hp": {"type": "integer", "minimum": 0},
              "mp": {"type": "integer", "minimum": 0},
              "sp": {"type": "integer", "minimum": 0}
            }
          },
          "cooldown": {"type": "integer", "minimum": 0, "description": "Turns before reuse"},
          "current_cooldown": {"type": "integer", "minimum": 0, "default": 0},
          "mastery_bonuses": {
            "type": "array",
            "description": "Bonuses unlocked at mastery levels",
            "items": {"type": "string"}
          }
        }
      }
    },
    
    "progression": {
      "type": "object",
      "description": "Character advancement tracking",
      "required": ["level", "experience", "next_level_xp"],
      "properties": {
        "level": {"type": "integer", "minimum": 1, "maximum": 999},
        "experience": {"type": "integer", "minimum": 0},
        "next_level_xp": {"type": "integer", "minimum": 0},
        "total_sessions": {"type": "integer", "minimum": 0},
        "achievements": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["name", "earned_at"],
            "properties": {
              "name": {"type": "string"},
              "description": {"type": "string"},
              "earned_at": {"type": "string", "format": "date-time"},
              "rarity": {"type": "string", "enum": ["common", "uncommon", "rare", "epic", "legendary"]}
            }
          }
        },
        "skill_points_available": {"type": "integer", "minimum": 0, "default": 0},
        "attribute_points_available": {"type": "integer", "minimum": 0, "default": 0}
      }
    },
    
    "inventory": {
      "type": "object",
      "description": "Items and equipment",
      "required": ["items", "equipped", "currency"],
      "properties": {
        "items": {
          "type": "array",
          "description": "All carried items",
          "items": {
            "type": "object",
            "required": ["item_id", "name", "quantity"],
            "properties": {
              "item_id": {"type": "string"},
              "name": {"type": "string"},
              "quantity": {"type": "integer", "minimum": 1},
              "description": {"type": "string"},
              "category": {"type": "string", "enum": ["weapon", "armor", "consumable", "quest", "material", "misc"]},
              "rarity": {"type": "string", "enum": ["common", "uncommon", "rare", "epic", "legendary", "artifact"]},
              "effects": {
                "type": "object",
                "description": "Item effects when used/equipped"
              },
              "weight": {"type": "number", "minimum": 0},
              "value": {"type": "integer", "minimum": 0}
            }
          }
        },
        "equipped": {
          "type": "object",
          "description": "Currently equipped items",
          "properties": {
            "weapon_main": {"type": "string", "description": "Item ID of main weapon"},
            "weapon_off": {"type": "string", "description": "Item ID of off-hand weapon"},
            "armor_head": {"type": "string"},
            "armor_chest": {"type": "string"},
            "armor_hands": {"type": "string"},
            "armor_legs": {"type": "string"},
            "armor_feet": {"type": "string"},
            "accessory_1": {"type": "string"},
            "accessory_2": {"type": "string"},
            "accessory_3": {"type": "string"}
          }
        },
        "currency": {
          "type": "object",
          "description": "Money and valuables",
          "additionalProperties": {"type": "integer", "minimum": 0}
        },
        "max_weight": {"type": "number", "minimum": 0, "description": "Carrying capacity"},
        "current_weight": {"type": "number", "minimum": 0}
      }
    },
    
    "relationships": {
      "type": "array",
      "description": "NPC relationships and affinity",
      "items": {
        "type": "object",
        "required": ["npc_id", "name", "affinity"],
        "properties": {
          "npc_id": {"type": "string"},
          "name": {"type": "string"},
          "affinity": {"type": "integer", "minimum": -100, "maximum": 100},
          "relationship_type": {"type": "string", "enum": ["stranger", "acquaintance", "friend", "ally", "rival", "enemy", "romance", "family"]},
          "flags": {
            "type": "array",
            "description": "Relationship-specific story flags",
            "items": {"type": "string"}
          },
          "shared_history": {
            "type": "array",
            "description": "Key moments that shaped this relationship",
            "items": {
              "type": "object",
              "properties": {
                "event": {"type": "string"},
                "affinity_change": {"type": "integer"},
                "timestamp": {"type": "string", "format": "date-time"}
              }
            }
          }
        }
      }
    },
    
    "quests": {
      "type": "object",
      "description": "Quest tracking (references quest_schema.json for full quest data)",
      "properties": {
        "active": {
          "type": "array",
          "description": "Quest IDs currently being pursued",
          "items": {
            "type": "string",
            "pattern": "^quest_[a-z0-9_]+$"
          },
          "default": []
        },
        "available": {
          "type": "array",
          "description": "Quest IDs offered but not yet accepted",
          "items": {
            "type": "string",
            "pattern": "^quest_[a-z0-9_]+$"
          },
          "default": []
        },
        "completed": {
          "type": "array",
          "description": "Quest IDs successfully finished",
          "items": {
            "type": "string",
            "pattern": "^quest_[a-z0-9_]+$"
          },
          "default": []
        },
        "failed": {
          "type": "array",
          "description": "Quest IDs that were failed or abandoned",
          "items": {
            "type": "object",
            "required": ["quest_id", "reason"],
            "properties": {
              "quest_id": {
                "type": "string",
                "pattern": "^quest_[a-z0-9_]+$"
              },
              "reason": {
                "type": "string",
                "description": "Why quest failed"
              },
              "failed_at": {
                "type": "string",
                "format": "date-time"
              }
            }
          },
          "default": []
        }
      }
    },
    
    "world_context": {
          "type": "array",
          "items": {"type": "string", "description": "Quest IDs"}
        },
        "failed": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "quest_id": {"type": "string"},
              "reason": {"type": "string"},
              "failed_at": {"type": "string", "format": "date-time"}
            }
          }
        }
      }
    },
    
    "world_context": {
      "type": "object",
      "description": "Character's relationship to the world",
      "properties": {
        "current_location": {"type": "string"},
        "faction_reputations": {
          "type": "object",
          "description": "Standing with various factions",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "reputation": {"type": "integer", "minimum": -100, "maximum": 100},
              "rank": {"type": "string"},
              "flags": {"type": "array", "items": {"type": "string"}}
            }
          }
        },
        "known_locations": {
          "type": "array",
          "description": "Discovered locations",
          "items": {"type": "string"}
        },
        "world_state_flags": {
          "type": "array",
          "description": "World events triggered or affected by character",
          "items": {"type": "string"}
        }
      }
    }
  }
}
